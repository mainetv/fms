
SELECT
        cp.division_id,
        divi.division_acronym,
        year, 

        cp.id AS cp_id,
        cp_pap.id AS cp_pap_id,  
        lib_pap.id AS pap_id,    
        lib_pap.pap,
        lib_pap.pap_code,

        cp_act.id AS cp_activity_id,   
        lib_act.id AS activity_id,
        lib_act.activity AS activity,            

        NULL AS cp_subactivity_id,
        NULL AS subactivity_id,
        NULL AS subactivity,  

        lib_obj_exp.allotment_class_id,
        aclass.allotment_class,
        cp_exp_acc.id AS cp_expense_account_id,  
        lib_exp_acc.id AS expense_account_id,   
        lib_exp_acc.expense_account AS expense_account,
        lib_exp_acc.expense_account_code AS expense_account_code,

        cp_obj_exp.id AS cp_object_expenditure_id,
        lib_obj_exp.id AS object_expenditure_id,
        lib_obj_exp.object_expenditure AS object_expenditure,
        lib_obj_exp.object_code AS object_code,
        lib_obj_spe.object_specific AS object_specific,
        pooled_divi.division_id AS pooled_at_division_id,
        pooled_divi.division_acronym AS pooled_at_division_acronym,

        cp_pap.is_active AS pap_is_active,
        cp_pap.is_deleted AS pap_is_deleted, 

        cp_act.is_active AS activity_is_active,
        cp_act.is_deleted AS activity_is_deleted, 

        NULL AS subactivity_is_active,
        NULL AS subactivity_is_deleted,   

        cp_exp_acc.is_active AS expense_account_is_active,
        cp_exp_acc.is_deleted AS expense_account_is_deleted, 

        cp_obj_exp.is_active AS expenditure_is_active,
        cp_obj_exp.is_deleted AS expenditure_is_deleted
    FROM cp_object_expenditure cp_obj_exp
    JOIn fmsdb.cp_expense_account cp_exp_acc ON cp_obj_exp.cp_expense_account_id=cp_exp_acc.id
    JOIN fmsdb.cp_activity cp_act ON cp_exp_acc.cp_activity_id = cp_act.id
    JOIN fmsdb.cp_pap ON cp_act.cp_pap_id = cp_pap.id
    JOIN cash_programs cp ON cp_pap.cash_program_id=cp.id 

    LEFT JOIN library_object_specific lib_obj_spe ON cp_obj_exp.object_specific_id=lib_obj_spe.id
    JOIN library_object_expenditure lib_obj_exp ON cp_obj_exp.object_expenditure_id=lib_obj_exp.id
    JOIN fmsdb.library_expense_account lib_exp_acc ON cp_exp_acc.expense_account_id = lib_exp_acc.id
    JOIN fmsdb.library_activity lib_act ON cp_act.activity_id = lib_act.id
    JOIN fmsdb.library_pap lib_pap ON cp_pap.pap_id = lib_pap.id        
    LEFT JOIN library_allotment_class aclass ON lib_exp_acc.allotment_class_id=aclass.id
    LEFT JOIN commonlibrariesdb.pcaarrd_divisions divi ON cp.division_id=divi.id
    LEFT JOIN commonlibrariesdb.pcaarrd_divisions pooled_divi ON cp_obj_exp.pooled_at_division_id=pooled_divi.id 
    where cp_exp_acc.cp_subactivity_id IS NULL and cp_obj_exp.id IS NOT NULL

UNION

SELECT
        cp.division_id,
        divi.division_acronym,
        year,  

        cp.id AS cp_id,
        cp_pap.id AS cp_pap_id,  
        lib_pap.id AS pap_id,    
        lib_pap.pap,
        lib_pap.pap_code,

        cp_act.id AS cp_activity_id,   
        lib_act.id AS activity_id,
        lib_act.activity AS activity,            

        cp_subact.id AS cp_subactivity_id,
        lib_subact.id AS subactivity_id,
        lib_subact.subactivity AS subactivity,  

        lib_obj_exp.allotment_class_id,
        aclass.allotment_class,
        cp_exp_acc.id AS cp_expense_account_id,  
        lib_exp_acc.id AS expense_account_id,   
        lib_exp_acc.expense_account AS expense_account,
        lib_exp_acc.expense_account_code AS expense_account_code,

        cp_obj_exp.id AS cp_object_expenditure_id,
        lib_obj_exp.id AS object_expenditure_id,
        lib_obj_exp.object_expenditure AS object_expenditure,
        lib_obj_exp.object_code AS object_code,
        lib_obj_spe.object_specific AS object_specific,
        pooled_divi.division_id AS pooled_at_division_id,
        pooled_divi.division_acronym AS pooled_at_division_acronym,

        cp_pap.is_active AS pap_is_active,
        cp_pap.is_deleted AS pap_is_deleted, 

        cp_act.is_active AS activity_is_active,
        cp_act.is_deleted AS activity_is_deleted, 

        cp_subact.is_active AS subactivity_is_active,
        cp_subact.is_deleted AS subactivity_is_deleted,   

        cp_exp_acc.is_active AS expense_account_is_active,
        cp_exp_acc.is_deleted AS expense_account_is_deleted, 

        cp_obj_exp.is_active AS expenditure_is_active,
        cp_obj_exp.is_deleted AS expenditure_is_deleted
    FROM cp_object_expenditure cp_obj_exp
    INNER JOIN fmsdb.cp_expense_account cp_exp_acc ON cp_obj_exp.cp_expense_account_id=cp_exp_acc.id
    INNER JOIN fmsdb.cp_subactivity cp_subact ON cp_exp_acc.cp_subactivity_id = cp_subact.id
    INNER JOIN fmsdb.cp_activity cp_act ON cp_subact.cp_activity_id = cp_act.id
    INNER JOIN fmsdb.cp_pap ON cp_act.cp_pap_id = cp_pap.id
    INNER JOIN cash_programs cp ON cp_pap.cash_program_id=cp.id 

    LEFT JOIN library_object_specific lib_obj_spe ON cp_obj_exp.object_specific_id=lib_obj_spe.id
    INNER JOIN library_object_expenditure lib_obj_exp ON cp_obj_exp.object_expenditure_id=lib_obj_exp.id
    INNER JOIN fmsdb.library_expense_account lib_exp_acc ON cp_exp_acc.expense_account_id = lib_exp_acc.id
    INNER JOIN fmsdb.library_subactivity lib_subact ON cp_subact.subactivity_id = lib_subact.id
    INNER JOIN fmsdb.library_activity lib_act ON cp_act.activity_id = lib_act.id
    INNER JOIN fmsdb.library_pap lib_pap ON cp_pap.pap_id = lib_pap.id    
    LEFT JOIN library_allotment_class aclass ON lib_exp_acc.allotment_class_id=aclass.id    
    LEFT JOIN commonlibrariesdb.pcaarrd_divisions divi ON cp.division_id=divi.id 
    LEFT JOIN commonlibrariesdb.pcaarrd_divisions pooled_divi ON cp_obj_exp.pooled_at_division_id=pooled_divi.id 
    where cp_exp_acc.cp_subactivity_id IS NOT NULL and cp_obj_exp.id IS NOT NULL      
        
UNION

SELECT
        cp.division_id,
        divi.division_acronym,
        year,   

        cp.id AS cp_id,
        cp_pap.id AS cp_pap_id,  
        lib_pap.id AS pap_id,    
        lib_pap.pap,
        lib_pap.pap_code,

        NULL AS cp_activity_id,   
        NULL AS activity_id,
        NULL AS activity,            

        NULL AS cp_subactivity_id,
        NULL AS subactivity_id,
        NULL AS subactivity,  

        NULL AS allotment_class_id,
        NULL AS allotment_class,
        NULL AS cp_expense_account_id,  
        NULL AS expense_account_id,   
        NULL AS expense_account,
        NULL AS expense_account_code,

        NULL AS cp_object_expenditure_id,
        NULL AS object_expenditure_id,
        NULL AS object_expenditure,
        NULL AS object_code,
        NULL AS object_specific,
        NULL AS pooled_at_division_id,
        NULL AS pooled_at_division_acronym,

        cp_pap.is_active AS pap_is_active,
        cp_pap.is_deleted AS pap_is_deleted, 

        NULL AS activity_is_active,
        NULL AS activity_is_deleted, 

        NULL AS subactivity_is_active,
        NULL AS subactivity_is_deleted,   

        NULL AS expense_account_is_active,
        NULL AS expense_account_is_deleted, 

        NULL AS expenditure_is_active,
        NULL AS expenditure_is_deleted
    FROM cp_pap    
    JOIN cash_programs cp ON cp_pap.cash_program_id=cp.id 

    JOIN fmsdb.library_pap lib_pap ON cp_pap.pap_id = lib_pap.id    
    LEFT JOIN commonlibrariesdb.pcaarrd_divisions divi ON cp.division_id=divi.id    


  